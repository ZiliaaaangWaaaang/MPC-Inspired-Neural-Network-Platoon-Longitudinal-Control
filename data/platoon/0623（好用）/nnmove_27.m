function [Y,Xf,Af] = nnmove_27(X,~,~)
%NNMOVE_27 neural network simulation function.
%
% Auto-generated by MATLAB, 07-May-2024 19:04:21.
% 
% [Y] = nnmove_27(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 3xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-13.2925490923537;-6.70139767883548;-1.99738196042707];
x1_step1.gain = [0.0638195875959219;0.168202204644631;0.502170423671263];
x1_step1.ymin = -1;

% Layer 1
b1 = [3.9889790627629939657;2.8127856888334656915;-3.1585673693317599664;-2.9035556287474815207;2.4780324641520712348;-1.9066697539931727334;-0.9226367817618255085;-0.82562480882857303133;0.37087150256242018553;-0.61175674679631242281;-0.31149692894019787026;-0.63794379753716889958;-1.296539625529042894;-1.7694261876700752012;-1.1626511265141799001;2.7046661979593364933;2.4034683558859284425;2.7020852064197291575;-3.4375339457681692856;-3.4797485116706261543];
IW1_1 = [-1.5888465576365011778 1.0515209030815901858 -3.3132662213789076944;-0.30658224300345487956 -3.9597617093788883835 2.2315401021957890215;2.3510535541124624181 -0.41038080347568584028 3.2078672622610389098;1.5810637993039595717 2.3622782817529524024 2.3834972823512248219;-2.3812843977512492266 -0.10042293475947963732 3.2157316862676190716;0.29388261458264985926 3.2472076154323801234 2.1715755672722201197;1.1801896477013740228 3.7139573989671701426 -0.29779332154004500843;2.4347245459490149955 3.2835655859885322094 1.4218253140495198394;-0.13090740713132867357 2.554395232948393879 -2.6420986097306564666;1.612024544877052934 -2.0715701086428124356 2.8495674933397623363;0.49499101467428968659 2.7733375536851654353 -2.7388555627322714869;-4.6065834443440571988 -1.2585134303995033633 0.59404266200518807128;-0.079985353264007935659 -3.2017056538691979206 2.3155170544401739718;-2.3105013859612419935 -1.8014480345617478463 2.4294429278642404313;-2.3822674374295265132 -2.3683278762434190057 2.258181001802380905;2.8054689672621133667 -1.2301800393517239307 2.2728989377884110112;1.2150225281303934644 -3.0139712384536077039 1.825275265268681002;2.5398590784036660928 -1.4698319878404664252 -2.591298377743562309;-2.23493066284440145 0.24505438399637158309 3.5250763610008761795;-3.326128791247612515 2.3137623409615954984 -1.3416950099053852608];

% Layer 2
b2 = [1.8244485096600526752;1.3693053103969774487;-0.82023942199975297118;-0.47243693601179315156;0.35057729600254583513;-0.49190603490064627179;0.61102775412523724352;1.0281721380019857026;1.1169058841209913435;1.8878716866012137388];
LW2_1 = [0.15135834070282791486 0.59602869256867196945 -0.20632232652894300085 0.321757583855737328 0.37096482462486518594 -0.046238001436034098512 0.075598125290924758635 -0.19719670075049730573 -0.59158194161872623695 -0.42961251091081514852 -0.063523367532981295236 0.092867591259930354353 -0.44096023809834722362 -0.59819845002675553491 -0.381776223182175245 -0.30531721852401572104 -0.29502195695146060661 -0.25692545771273400668 -0.44118878131642347284 -0.60733836117734718574;-0.080535155280399881028 0.78535622863301701724 -0.32431922357172576765 0.15442055107441465811 1.2179790126313962961 0.4274364680511042458 -0.052715043893485080684 -1.5052881738911445542 0.45039587674850789512 -0.099653407120490325455 0.073678666010094387429 0.84409995584604824437 0.095080275818908599472 0.3607026546698105518 -0.36656818968304261119 0.43926295007225912848 -0.2543852679286169316 -0.10157202959780940732 -0.21960007029774689102 -0.44556904922611356712;0.78881277836103524947 0.83478303956989641232 -1.1368785579164255584 -0.84134490999213118467 1.3176548949458437576 0.029330641430136722425 -0.34539829566338675626 -0.65678093920946412076 -0.1862671214630248484 -0.17836076784535090378 -1.0210564498848804238 2.3629706343210661323 -0.77955823721729478049 -0.36627950083136279202 -0.29560551498292342298 0.66190523253049182717 -0.41216987890033546238 -0.5964820644001652683 1.1618442910718462802 2.2993838567206403845;0.75213066369806391709 -0.17406954499790777691 -0.48356300324887790953 -0.082716961147597717341 -0.23371399689553426504 0.025615593827132264459 0.013995559692634527288 -0.62653931697330966788 0.6542358861037753659 0.13866630902024518202 -0.59449686647470656453 -0.44223760528960015526 -0.47115804041499226296 -0.56111282656721550577 -0.81546965313061625658 0.74201138402191524346 0.24409507418499082343 0.73340554461604923198 -0.70482331853837665303 0.086448939933970334049;1.3144193527835621449 -0.52855233627251863027 -0.66325311997481173343 -0.92376914132169940519 -0.29488793768997961786 0.58314928340886429403 -0.57103260718097459403 -0.35189951384475476326 -0.50535633386560341318 0.15606564435297473614 -0.25419611950580306425 1.0590376923837021561 -0.1537400804552712108 1.0895792147689120632 -0.034647630089876015058 -0.65165619751457048991 -0.34470686845638831564 -0.34258114963908181672 1.1962122481840291588 0.87901476379608312062;-0.14001015616548678766 -0.15518016536016054907 -0.36197108828626373134 0.072817829302010195214 -0.51347596447970467182 -0.28471842691570403705 -1.0771384355201503169 0.42359334832763168022 -0.38031223179710271776 -0.88326571100941875248 -0.72619928145661716279 2.4554425778972319705 -0.42794543251403571738 -0.66271699169092024295 0.056197873723604602203 -0.71613178747002348423 -0.34963364019201481625 -0.43985564575125762898 0.11919635074565504418 0.83230941079326004051;0.39036072065951732402 0.17958122131140499822 0.47377554877071070827 -0.61730564194247938836 -0.18248008550145589091 0.087246130573006286379 -0.066440539098791856487 0.18005392189743929521 0.36506836520651619882 0.037526292114079866369 -0.27370308815819399673 -0.3715103462200457507 -0.17087278352376492063 -0.62865160939975028853 -0.42900694978179076955 -0.21114359863383050375 0.3249641337884930925 0.47312941912122036259 0.4345191677136320263 -0.052143027414826549626;0.65708765846384376008 0.3871635494606074368 0.027341069256656670705 0.20353432303541424409 0.1726969508842705614 0.022625090681258220454 -0.013503189740938904492 -1.2857311591941926743 -0.49301021888067531052 0.34252530720169360734 0.59470295805333706074 0.56466275393522524784 0.52169303497127317293 0.032680656787949985409 -0.39776968085562885991 0.42026376406987919765 0.12675915842047597026 0.53586954647729978518 0.23500127913139740032 -0.3548735682121282875;0.24078473329763758204 0.56046010048863870168 0.048302765506274152052 0.57896241933022640769 -0.26074245709605459176 0.36607345717021549936 0.18270701624145618824 0.6754420864099048849 0.35606707818653338116 -0.66801037008274311013 0.58109179428522228505 -0.14192061424547350312 -0.51875695893112783175 -0.46186776268253781907 0.38089887537093836123 -0.54881913643931379276 0.28397884677877677229 0.57447224587669554197 -0.58462536746495574747 -0.8084816229609493865;0.33323615850607629651 0.88979211513001654765 0.21096751635212213083 -0.85568635684273675057 -0.55219369963572306759 1.4382227440858457168 1.1211290292134887814 0.41745099061774587623 -0.12214869745576295568 -0.6664431333766751564 0.24211771297592835084 -1.8467287341935449962 0.31752712112157471802 0.38258496138200104308 0.44021181486638139013 -0.76572664419691627291 0.049029318297756259437 0.063388199832443647974 -0.57373067002081179488 -0.10000992040973094577];

% Layer 3
b3 = [2.0122409418940230275;1.6799876898755954358;-1.5917988880320830258;1.3091837057839366132;0.81401825851578990534;-0.32356950828173436374;0.95355121672652976006;-0.35404674629865490187;-0.17176411987612000276;0.0097913446810648056828;-0.33856091648250813408;-0.2517258041230043264;0.45325014045085437742;-0.70427384539605231151;1.0968748499016744979;1.225102357389517449;1.5552129741717823919;-1.849391441245460177;1.7629126029616231097;1.5867646057743043375];
LW3_2 = [-0.82313782093897780445 1.0381412642888034892 -0.1814256655712734867 0.23201845182358871167 0.4966827127085960969 -0.29915491447663661306 -0.80199181444489264781 -0.040464836541254815827 0.63210813256180931052 -0.38490680319220665906;0.063382856955522121067 0.46209478611140303306 0.91717993779861017867 -0.85680124935402990349 0.75622373665241204854 -1.1465221141770729485 0.73680060600370655965 -0.50681426960047371022 -0.49627241429940172068 -0.70779404691262925997;0.26449813553121237497 1.0309007494444517583 1.9848769164783346408 -0.69355992904681484923 1.8416020045270811156 -0.075321170521189431679 -0.051459713343973492727 0.62697617361354662791 0.6612234075113124776 -0.49583315569536129397;-0.7430925548025247851 0.65936552524767255701 -1.1399854068488621817 -0.065263001186755917327 0.48023793080256138577 0.76558114719042336116 0.36648618131567012313 -0.12035234308437679773 0.45507971461588531126 0.61924808647464724132;-1.284604793754380081 -0.042421036244722563902 -0.1531629956690357397 -0.16826097462476469202 0.45202781251904239346 0.059382209959973480951 -1.2095357135744839727 -0.20218444201768870361 -0.17307209904426115732 -1.2208590143668109906;0.57218592100946241708 0.28159862397112017662 0.21105195958057282324 -1.1157955843640015026 0.32702851005530692019 -0.30760553375543447929 -0.35615786372630447998 0.24895847381898811301 1.4556380563523956262 0.79968833127707550368;-0.61786332532208687596 -0.42351280760296045047 -1.3988509918010145761 0.10628413286186849662 -1.1010747886067193679 -0.10188985785804442752 -0.27677626377334413332 0.98272816958853592695 0.90572448379356529369 0.3321309286687029183;1.0955300752566414779 -0.63984700147495066069 1.3232546166873113691 0.1002354932706804036 0.76326435017924232351 0.70391602430401190027 -0.37797287245932470467 -0.2913595125403835584 -0.27149833034345721705 -0.25933732678915177861;0.81954814137194886836 -0.5646296699183597223 -1.0775726951328188363 -0.4156441523784020764 -0.85084917727065934034 -1.1378900324802729838 -0.63790864540104119662 -0.061165091388391386318 0.73305211789450674953 0.57785839965985874578;1.2352677552448967369 -0.49852943540744260043 -0.99631471785439396083 0.081927783186103816937 -0.089818177771003662735 0.82078156252693501571 0.34502547220593243749 0.14921688168360000559 -0.69484723157743522037 0.41496577038243953606;-0.75195738667078748652 -1.1204122309120689849 -0.68074141042830815795 -0.12817320480243779568 0.55189620785985482598 0.031770979367879224886 -0.0081460255656663291962 -0.87001406282720428198 0.14889118922672014977 0.45687564256348756064;-0.6632309321082290321 -0.49122976276788604677 -0.82703253705039159183 0.3779797725982448342 1.5068905565618071485 0.11466128520446602912 -0.43594193806526426727 -0.038688645517755013148 -0.79485553551162080321 1.1015612913883199298;0.26315667874730713782 -0.53832584321858489851 0.0062394894747474184335 0.43913096415173369369 0.68866796109223871181 1.490176357023817566 0.62761570244399778051 -0.77481634172544633365 0.3102187149078340922 -0.57790645490213155;-0.97686027302829037122 -0.71163104934741328034 0.53309597046099621576 -0.55128016996263073946 -0.67927906620632250156 -0.044116259543855979031 -0.093720129793442505384 -1.0308676779316301442 0.11265633480656032928 0.20260986053462506917;0.80221178126436221145 0.71516264726177969369 1.1070890702766229552 -1.0498639900973838479 -0.7999326276392789703 0.43021918550120152869 0.48824023105096170383 -0.38421080998684525865 -0.67094480386623733814 -0.36601274993035465277;0.96153802081380790323 0.51119786464490546418 0.25183679943554326819 -0.8665916362247689797 -0.79537948594116170131 0.22845963775365829562 -0.36527450418068441174 -0.084486336874671358332 0.020012959943902727117 0.60830553485497451671;0.37765652326978588205 0.13255533418009576851 -0.71581973427869227677 0.3355397361636628939 0.060737274880282535183 0.57011122578466921773 1.0726790487828352649 0.49301583900595619125 -0.48198508869885187123 -0.72851814330846798029;-0.89058569693410483126 0.22002784481915929615 0.023352222574225717927 0.46610646777054504097 0.86382912670214972994 -0.81119417085231881881 -0.093487665417263596246 -0.33084101914070812578 -0.57840762298142878173 -0.76895941254205923965;0.11643667177325889295 0.6631357350431255071 0.17724737752149363756 -1.1529469534569025679 0.47342591136325051782 -0.92899653888325717244 0.16606737189460371584 0.22316698961592959516 -0.41942113179074513862 -0.3693558974622598301;-0.17737304075961538019 -0.74606987143848635391 0.010178044117968645943 -0.53537072005384744866 1.0703462691963727682 -0.3209234893111461151 -0.84552403827171507267 -0.78472999044125790746 -0.16793610777347059426 0.98112063350697387154];

% Layer 4
b4 = 0.030608568367143616784;
LW4_3 = [0.44553717211894239281 1.1739809437253212465 -1.0521348769130429712 -0.262131653531730624 0.26965782931102916242 0.27737047737212655596 0.51504824530157611306 1.4491514088549160011 0.54237859438900470899 0.33329100443380421659 0.95249442597661726495 1.1060059864147355757 -0.43788244153955019344 -0.38139278132098941576 -0.89981015154752352903 -0.25939900067376248094 0.11248884267029479744 -0.63510723198492480268 0.23848561942519599932 -0.52044166621089915648];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.499999999999945;
y1_step1.xoffset = -2.00000000000019;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = tansig_apply(repmat(b3,1,Q) + LW3_2*a2);
    
    % Layer 4
    a4 = repmat(b4,1,Q) + LW4_3*a3;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a4,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(4,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
