function [Y,Xf,Af] = nnmove_21(X,~,~)
%NNMOVE_21 neural network simulation function.
%
% Auto-generated by MATLAB, 09-Jul-2024 21:23:16.
% 
% [Y] = nnmove_21(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 3xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-9.27187740505682;-3.65799721531803;-1.99999468395731];
x1_step1.gain = [0.104758804509858;0.259072168169289;0.50000722551666];
x1_step1.ymin = -1;

% Layer 1
b1 = [-3.7839772016289328072;-3.3377952020030821068;3.0556540536030869504;2.7543610964696165766;-2.5402486878353989219;1.6758516115909958266;1.3512804706185117531;1.159299292721068797;-0.63178841422679898887;0.052186328659204979374;-0.54377719355891085407;0.3063922849642599644;-1.3863506151873199457;1.8594817122792974828;-1.9195189708692377284;1.9170500452164693783;2.8735375215035441343;3.0705260632122453046;-3.7121610480781153107;-3.7540674140216232502];
IW1_1 = [1.9915384682870016508 -1.5970490734281361789 -2.8353829299908110961;2.3792910636179027684 2.6838116578787567512 1.5130992294113936314;-1.4966854762514012478 -1.6176970632053240262 -3.000919604815892594;-0.25124136063268387442 0.45671448055373248254 3.6726836468703161209;3.3253913871230729171 2.188911717382053812 -2.4678871869829355212;-2.6433214188424014601 0.93469671721540514842 3.1322865285554088999;-0.30733414187644980675 3.322341547263599093 -1.7298881285545797404;-0.61765449684969431221 -1.5484436134159809129 -3.3965939232789730262;1.9342773570181699405 -1.4243003237093470048 2.864644262029620414;-3.3321697581900715512 -1.620836400132236399 1.0058668316617913607;-2.685992062519332535 0.080643639288263860299 -2.4822855453434513606;1.3132373438280005029 -2.6631221029303571157 2.2186144679836332649;-2.1516522113886651368 -2.7942702190868580203 0.86334882020048597795;3.435479760576388486 -0.6232449579005939766 -1.3482459570411986505;-2.4971566127857798278 -1.2356174391814196412 -2.0880290205999214592;2.6485698544086195838 -1.9726662033390847117 2.0654095348148633349;1.0838818400050289625 -2.837623612265834705 -1.6675975954306232474;2.5232024473101954953 -3.02160261367552474 -0.1257470858281442283;-3.129799581907001027 0.45135893875382582241 -2.4279890900123253239;-2.7243003804632075493 2.158033857170580827 1.7584312706606202159];

% Layer 2
b2 = [-1.6203426911884397654;-1.0306475687959182341;-0.88165484007846772752;0.48740891867545321769;-0.23953777826759120595;-0.1963246605056612748;0.56894503402210938603;0.67381919998026884588;1.3718552228616487376;-1.5570369212798900183];
LW2_1 = [0.297436545868876967 0.45164283692177237262 -0.24867941653090794296 -0.015704208059406844777 -0.61451489072167420069 -0.66042043829180951953 0.45875919894870709204 0.0680481109184623012 -0.38807668067310585602 -0.24341592273542447811 -0.24251142625190852398 -0.15787622531465139719 0.83577184801122594848 -0.024703306122428377728 0.15011694265259081793 -0.4504762610536056644 -0.19589108627424464681 -0.11933676242664707778 0.48227517032937750052 0.45280224105656902145;-0.045646701172731438123 -0.62832715201424038653 -0.47453379907599502197 0.11901290277338771872 2.0124072682782290222 -0.87182561064582597687 0.020090442610548518015 -0.26809729398837234271 -0.14798192501185744585 -0.78049143375696661273 0.058058822657076708529 -0.73418737960089852645 0.11804745506700012325 0.37344821067819605753 -0.99044079908345583618 -0.12590461245253195544 -0.47455117302372940014 1.0862964300790478589 -1.8213351913120969794 0.63877249580587391886;0.46805985384709708486 0.07154761853984187292 -0.39353810545202000393 -0.24323223189053555515 -0.19394631236020529186 -0.051671752886798393012 -0.20459400725376558627 0.84033988295371075949 0.27001319180381944118 -0.24067642627246627063 -0.19118028127481812017 0.24735601880349866732 -0.093914328013708525678 0.021456026127797591524 0.26724874022669209417 0.477555659803363175 0.40764971162650265324 -0.49436157769403049622 0.4298477481812994494 -0.49143473133234111261;-0.42523975631106936124 0.45862557192188879718 -0.20657907047006288104 -0.34938439205325089176 0.68494073070386118918 -0.17760787771472666408 0.4028853211845730975 0.50516179581573483759 0.10048705817295494613 0.54985133172711675442 0.45585824207014014053 -0.035939941806593246609 -0.070450542470459717737 -0.17811505859608681157 0.69670697417569982246 0.21762463125465192348 -0.61786658031041497008 0.025687881751517420426 -0.02201291863217608169 -0.050536321935812721085;0.35435942700063011168 -0.083590815916202432234 -0.2679345056916255241 0.50123017343108910993 0.065671571617089433137 0.33655587463403630055 0.04612277519902131806 -0.10937740452580056727 -0.31115042692959904436 1.3187696524638623519 0.4097840346724848648 0.27837000721078009047 0.74630912025729645443 -0.63578394492020762208 -0.11219662957311132834 0.0080478183482522221842 0.71747762650629021142 0.1733655034280252305 -0.5332922374068796989 0.41830272953356739674;-0.41354393501004721445 -0.52173246456003496974 0.64973375059405580334 0.78201765850738580443 1.1852664303150570735 -1.4925712235713817222 -0.2491848818473883509 0.47925279883320387464 -0.11968205462579252496 -0.081950217710891795631 0.24111754584309655347 0.3413805835591525728 0.12779601219480118957 -0.22998864741656346866 -0.85115280696720907461 0.29213991994120624973 -0.30207273400796397222 0.057163158062384575309 -1.2476835012673490599 0.10620681894044699256;0.34535008990650806204 -0.32806750294637793131 -0.31245397599851881809 0.3552960031064721913 0.3676287845409084154 -0.37716258094692572955 0.10023040735181165672 0.50164041373958945247 -0.48413571372962210804 -0.25078568063852607617 0.57197807315160620334 -0.52207524834626373167 -0.29489533246441712588 -0.070049389341908713247 -0.49011341881180425784 -0.167710800580794267 0.37300266810711751875 0.20878170841575396932 -0.435848551974118259 -0.70634260193753450885;0.2640677295976243677 -0.2521685665188987957 -0.077830736973875477847 0.49642621631173583507 0.30928052327540644928 0.40724389287137208182 0.22571473083511292557 0.50663641121933256084 0.00065716941038137144555 1.1433385837734901802 0.53049955491346578729 -0.0030143993508244849855 -0.27007960876352932189 -0.30067302538368351206 0.31078450502810428535 0.59506151159603370981 -0.27563349122206015629 0.042852637836148385619 0.42383427499542086769 0.27662093625922140605;0.031631934348030542326 0.1808991288042136325 0.26425491973886289232 -0.63185959153918636044 0.10316829878346650551 0.20630460951891160803 0.26509973096011901772 0.78891540372786450597 -0.047574728188027354259 0.46849984257329241322 -0.047615951788513861953 0.36288548080201649126 0.026164832223951110107 -0.13880636474662644275 0.21650602766751472772 0.16629777940473627895 0.16169350850860630953 0.42234523753235336807 -0.64788806870282200645 -0.45438054526835214286;-0.48400542089487275099 0.12493554647767750321 0.24223060965792778121 0.68493483716415493046 -0.34769798982001942633 -0.013030884366538115354 0.61693509643628396955 -0.11448502501357678274 0.00023633173788161973561 -0.56830247106905618093 -0.53652656328762515781 -0.41181357940471269297 -0.24565518089391924494 0.78752323029135362642 0.1097246934334600299 0.62972636186698260907 -0.32648782499240641686 -0.48462185202801955075 0.25975811991890984665 0.27522949364754500934];

% Layer 3
b3 = [2.0044065772702213124;-1.8285063907749605772;1.4643819712284078527;-1.1893044441482407692;-1.2889190630789275627;0.93352990880424480125;-0.73128644404743559093;-0.56343813406519105413;-0.13869496615339621526;0.055514831765400445007;-0.24699511111021352217;0.303788019200919579;0.52748869751476645806;0.80810317430200073741;0.98714444479290974765;1.1002684359599987918;-1.1725272106876556411;-1.5320297688341866227;-1.619384865532725426;1.8698926234043187211];
LW3_2 = [-0.44848419703580832962 -0.50198384482875246793 -0.078787283742399571995 0.96407925918729786563 0.63948018043717658188 0.93576518145387999059 0.082064009708164728507 -0.71830104977922526466 -0.024379142791515623356 0.34149531680000061451;0.87172463648550013726 -0.75087386797617561296 0.18798306758102573122 -0.177987379261069667 0.74517847839209083727 0.3393136244408832547 -0.31206676488161277927 0.77088045717085396102 0.17219478782048416865 0.81754448944214608286;-0.54263939719454568067 0.90341071223342239715 0.25904355356629787943 -0.39171783024481643398 0.51327365012860182159 -0.17137802558722237123 0.72606608936098038232 0.99321174666913769613 0.65201945565189456389 -0.10517438273712796659;0.5641339274355781086 -1.0786016927644055396 -0.76954325532143086352 0.6988786367020393131 -0.94427589958792734759 -0.62513711048904774259 0.09965337063448823085 -0.36977135336344507666 -0.30007426593219765909 0.52368869141366614084;0.44091950151816111658 0.72128112175544678575 -0.32325207672561651062 -0.20407036394572752869 -0.15590977400910321915 0.74092813444970506698 -0.84006163136079559095 0.57314296143310494713 -0.94159447756447367528 0.039372579212206541832;-0.57130004906554798794 0.2823752862025364907 -0.43783846880762250509 0.26641670268080330786 -0.39743671819369363885 -0.39690934495355334466 -0.18660336326869453316 0.90143170073922895824 -1.2048883007517219301 0.49432400599730708102;0.25287627208733026718 0.27149070511592177102 -0.61618314867421097869 -0.096457390847460966476 0.83431921976057632495 -0.43676981942211495769 -1.4001826797767142896 -0.72302594066926972882 -0.1076483961294425612 0.0096145977243272222335;0.435043725751153465 1.8741676166935012926 -0.84055045113669968337 1.0307203014208152769 0.38092404761568460225 1.1257685197896485363 0.48095084132852056191 -0.45860833256841898598 -0.50066923285753417439 -0.46317480215470113736;0.51131569419921019115 0.064644428050171634514 -0.99463200637606208332 0.43135863269326563119 0.52563507916060803193 -0.66581715021965504064 -0.32109066706810474034 -0.44067829579450890076 1.0055377597469374873 -0.99944355818459029717;-0.86524575020574878703 -1.7953928650922383881 1.0451009511570807931 0.13887099960203802551 0.46761854807280917035 -0.53296184704298410484 0.36507726364077097703 -0.76120443825681494143 0.61947259166412926845 0.69143677834577277341;-0.69004239665222377731 0.58164111592594014422 0.58325395289096926277 -0.4280441967981472029 -0.40121602635616171462 0.92475886676729535107 0.69882045365971701134 0.43049157121668774062 -0.30807246301995366844 0.3985364839158959116;0.4852683116489540649 0.75407077557883184227 0.090940769114932568096 0.46873117717940909754 0.64373327074899866496 0.2048582838604309786 0.55029989367274123602 -0.15032788538511565601 -1.0485443373140013179 0.82590061417532534271;-0.01668076387539156949 -0.8271547456274030985 -0.40377554976472579407 0.33023633037565147674 -0.79007092589359795287 0.93630956035995571707 0.47730727538956729816 0.057588114362476426622 -0.72039392303130600492 -0.58148285703034374716;1.1630832669372790367 0.051541358489687556788 0.10958128212839107762 0.16228867613519265545 -0.90952583318518165356 0.10811328642305516323 -0.4564611425648589238 -0.49520492374692465232 0.6894341583159443454 -0.66059205330651193933;0.91715571630127046276 0.6723060021145192966 -0.31828819174000122505 -0.17667998880878388324 -0.47481036688812827684 -0.44939386792249946811 1.0936894023487002681 -0.31964119419270137223 0.3244088017226998133 0.11868311914302472065;0.41984711988770245794 0.59893504190378954455 -0.77779353816870522298 0.42618657975798662774 -0.92111262014833883427 -0.56896068589113113489 -0.71986142181780832239 -0.86275727899533427578 0.087291364313956273935 -0.14525713691650052328;-1.0299425337192336105 -1.1538830178514691838 0.1871054872263332447 -0.46470700077067972344 0.56740241825656867469 0.37868333697042966257 -0.50761073553580104978 -0.88383777571276744833 1.3285170949915931296e-05 0.42451039491438574691;-0.89877583283352080468 -0.45111308528472676693 0.89117468905067886986 -0.17259244146901436823 0.20678325502612035502 -0.5481812550925245775 -0.31866335445946736282 0.23761872168125589 0.59539395164717601183 -0.66041692771546911533;-1.0342225136433385035 1.439038674018064734 -0.64138089386567720407 0.99830382520034677274 0.78581811199409867807 1.3129487154582488717 -0.086764925190812483558 -0.23087627936486784797 -0.84739939996591562288 -0.85297966833120220098;0.20589366828173238932 -0.23133755213931997408 -0.65421140343582773191 -0.33743778137311347676 -0.5952465394584185443 -0.80703355922035102665 0.83631406234600458305 -0.091059203084065509781 -0.63974541037265897359 -0.89227542934393244689];

% Layer 4
b4 = -0.038841188371350331143;
LW4_3 = [0.15286304882008053263 -0.7617189152122172402 -0.44139251312713284614 -0.7859217426052389488 -0.72705821764042832811 0.55208348264838891239 0.77421539505343150989 -1.1742637179835735406 -0.677078801314101697 -1.1338631695178744696 -0.3295413787388648541 -0.032111832196738965273 -0.10783165787582281447 0.34832429002981923905 0.52690113167264440719 0.3983561178472377895 0.73579946485632796715 0.10087104741039973343 0.85354263823126785837 -0.41675766512837064681];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.499999999999991;
y1_step1.xoffset = -2.00000000000003;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = tansig_apply(repmat(b3,1,Q) + LW3_2*a2);
    
    % Layer 4
    a4 = repmat(b4,1,Q) + LW4_3*a3;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a4,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(4,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
