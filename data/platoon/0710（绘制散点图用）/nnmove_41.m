function [Y,Xf,Af] = nnmove_41(X,~,~)
%NNMOVE_41 neural network simulation function.
%
% Auto-generated by MATLAB, 09-Jul-2024 21:23:37.
% 
% [Y] = nnmove_41(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 3xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-9.8820989364874;-4.17631009264064;-1.99999468395731];
x1_step1.gain = [0.10151410520026;0.23976556688107;0.50000722551666];
x1_step1.ymin = -1;

% Layer 1
b1 = [3.8731439916080292463;3.7118109524353557482;-2.8082750381996381961;-2.6167787488856717459;2.864061731362758767;-3.0967975346756762001;1.4760076367773959927;1.5272064908924216642;0.92941091715801249507;-0.31100373793834235059;0.13396719637489937216;-1.6677880193812628651;1.1654300078798269791;-1.0599430972840859777;1.5785298484168230893;2.4738628414785117648;3.326986679921640544;3.1675312240078445924;3.5633203836663098762;-3.5290527658082546658];
IW1_1 = [0.083537621588660099237 -0.76890102637321844359 -3.632596824951512815;-3.3587658985310593351 0.20702065329725535814 -2.5056433913759152965;2.5245230372103928396 1.8798531081832250411 2.2646144374892460682;2.6734085751787461938 0.92680004048511432924 2.6078947044402438493;-1.2769335659358427293 2.1844555536662486617 2.3620707286259809976;3.515031334909071159 -0.73234006418022601359 -0.80230373659565823452;-0.77208996146384056836 2.6354125681068305553 -2.2158901002365944954;-3.8068202153898611506 0.055613154680878275349 -0.54075511334646231276;-3.898568140868856613 -0.76930326526130421438 -0.63100479642748730225;3.392554515927669101 -1.3968094466364340267 0.74034723609300123748;1.5946582753471110205 1.5075393088155064625 2.6624225877338401069;-2.6489847310334915242 2.2819611018674765823 -1.3722404040384470481;5.0683301711915573762 2.1275248034359837135 1.1012367043429927005;0.12463975798235786552 -2.0023955490428764215 -2.8302106054355151699;2.3068970693505757019 -2.3661863969686200981 -0.69178649758487031907;0.74653940814543329196 0.67114950676692930465 -3.3278286952708127089;2.6098364060169347844 1.8996220478435226209 -1.2628720276573008885;0.35279098754610971334 -1.8776460065531739296 -3.036564519738274015;2.7926169628616013263 0.15211183123820107288 -2.4389819089296369548;-0.88698759731720289157 -0.75662627272073079698 4.0888730132790946925];

% Layer 2
b2 = [-1.8387802253487826043;1.3636075010230053195;0.73338040768678702808;0.40711269868810601169;0.30829420282666442077;-0.47264409750216812567;-0.66199655011344238353;0.83832425394672860364;-1.2865455169262578483;-1.7270423282473754689];
LW2_1 = [0.050265328880728613048 -0.19151834429216285649 -0.01842980364607688451 -0.09184445033863269936 -0.19829511280165540432 -0.050718945587489794313 0.11915059611885757407 0.050798760680310507676 0.59842182996332227152 -0.30028434092419886703 -0.42759427419485557254 0.21508207567390810744 1.6316359783892198099 0.9208528450823797451 0.43680622157736453959 0.56119990043237832911 -0.3608903771323018761 -0.11537360759419283684 -0.22094096844961855219 -0.10988478083273051089;-0.25725495854082669478 -0.12921758048551953979 0.17400245862923804929 0.20383679576171664927 -0.27416743422711603584 0.1489004455047024944 -0.04592426297781151967 -0.84037230462193068803 -0.51905955553016924764 -0.18740981215967358886 -0.30639300937133745473 -0.55530540140020667739 0.65108090231428872308 0.5811434573330200859 0.31766822623754620292 -0.66521594654014037928 0.34697152648735235525 -0.18427342307753097339 -0.42617644996374831612 -0.45323702377383823237;-0.19149256955456506191 -0.33838767349406195795 -0.7178169442135493572 -0.35657879501723682703 -0.44076249037383885554 -0.358015384120219049 0.34446454488693106777 -0.99267427121306150983 -0.56872462007640633974 -0.50878814535231642324 -0.021311966310595197027 0.18736997767728072462 2.0561166694191963522 0.77684250604610516344 0.022908351702088821517 0.84667197977076902315 -0.51472027351482174673 -0.72583517498365868192 -0.14762878387773359368 0.33270550070278442911;-0.19447015058727107339 0.14249910474547228256 -0.66553459864444497462 -0.26137293172032788346 0.072053588304992338687 0.16925524362642480058 -0.45891871225644231824 0.11164186569570723473 -0.44190585875157456508 0.20841591582326082777 0.31114345064184251166 -0.93071560978353662374 2.9824435987189326092 0.34416907342996527763 2.3504773796935389818 0.48472032217420446543 -0.49632406500410414241 0.41059285351669183584 0.19965387723605718118 -0.19224829152061662096;-0.4670392843296720109 0.58607255913609379583 -0.39151337261473617701 -0.24350331355660964627 -0.22201317156655928087 0.06347723392526610775 0.14724219198094182226 0.55323513807717983326 0.4112222158918235615 -0.328575534670403957 0.23176189348878944996 -0.27038037456810198877 0.19978318578422804563 0.2571436933449220974 0.39114667789684548493 0.46379864785927127357 -0.16911719944753891842 0.48258473872586682418 0.59666825732777784008 -0.84595186168179992148;0.065300146818064591647 1.7874959766236515613 0.4699831566271718275 -0.78287008910404087825 -0.38445320818279765662 0.15479824383299581325 -1.0958332681119780094 1.3838872304640845723 1.8310552692891166604 0.38770328013357013841 0.40802215468882069294 -0.32590707073381969261 -1.2438994047713063384 0.084799361357573335707 -0.22173956786717091694 -1.1973300980806964589 -0.36290197920321826119 0.37821574981621658429 -0.66339366856116599447 1.1639597652316322485;-0.66420709057915217066 -0.37277548914034713823 -0.25837037742594903822 0.15107137568379666592 -0.39832935861036650182 0.089067715592102469913 -0.052502335547380249436 0.3048744545525381433 0.55002618088175270206 -0.083479809041173330675 -0.045091732107099845306 -0.047300267805072335192 -0.54660201248839035415 0.26153494798731774518 -0.61527808124215610519 0.041770947119476133091 0.33340800673390147413 0.14703764312537964676 0.36435349910178493893 -0.44932298590444413877;0.47425241204466078715 -0.54793033166485216601 -0.3919447726710874047 0.5964640219960060108 -0.038103568408744764584 -0.36976757888232425486 -0.33238874662995299136 -0.12855211315195613775 0.022274493130815566089 -0.087164946214180777373 0.4936495500523508384 0.35427628144298611845 0.32751714875602810917 -0.40298876591191495899 0.44095816117006758628 0.30652759154920988793 0.19320766810629405597 -0.054006235837517249654 0.6132816067024050577 -0.14987016946032050146;-0.5687119188545809445 -0.28239489966100927987 0.62179746603573826658 -0.44707052503947208866 0.081932156966089714212 0.02037123792373836742 0.19268463451069575698 0.12177004490349091492 -0.050486247303789345831 -0.52014741360066574227 -0.11412250791469802369 -0.42061601765524869734 0.056709720441584163253 0.19086334695214604573 -0.24927967110332036049 -0.087770865317631632796 -0.01322961872782927803 0.15139147506412664601 -0.31559664805631437723 0.83588759285670100052;-0.40904357872082430791 -0.13882440354240976887 0.27366553578604624342 0.38484104023456189303 0.017191720754240847474 0.3027575642270048939 -0.040942427151645262307 0.12917830566137716852 -0.4491744711433359738 -0.27455849073836202656 -0.27586356279211599052 -0.39444137591667582932 0.39520042837780611222 0.055677207256780908429 -0.51283696788354593554 0.50960991313939218994 -0.61824387482408615924 0.29384556756754759421 -0.65039677230442183298 -0.29156471099193143059];

% Layer 3
b3 = [1.8219222530467820143;1.6704375581435051412;-1.466108544538112346;1.4410380850056130342;1.0581181454909338591;1.1669454655796134279;0.86330227867376130302;0.74226550981263494933;-0.047238551415247326259;0.22064958679832735733;-0.10679409123157310169;-0.12654426026752346734;0.34437946956513426633;-0.54721654025731103488;-0.76006076655746857007;1.076328369640191962;1.2107091985689022451;1.3804493549351120052;1.7187329914908322515;1.9009269755129274415];
LW3_2 = [-0.84099732349034361789 0.00373207080893087767 -0.40603265968359236737 0.021087745435658535043 0.81293907902752371442 0.2188588805827241246 0.84390032994095232066 -0.92326830032415929672 0.6685667393484083787 -0.025023701386521476908;-0.44144718027132140437 -0.18449750680469637065 -0.60445552198186447423 -0.63342567966438023674 -0.14832008889136116814 0.52957149199758690727 0.57877598586049772145 0.6595306466200041573 -1.1682539153579851732 0.36960718276499349155;0.59452877466378450944 0.44937507800104858902 0.19114067560837941229 0.54531132760636091827 0.71283944890450967602 -0.76547412975026318804 0.76223006584849739564 0.93024547037796889715 -0.22018239464262115423 -0.56399072122501392457;-0.21231283610278514629 0.16707533772537291883 -0.84579169479072557891 -0.025992850495079645318 -0.35982127606897473804 0.26872866033473591374 -1.1364657405039766402 -0.65185578885470651933 -0.17102687784670700388 0.82083557019656883114;-0.94002586583056046976 -0.5202714872507157029 -0.14606080663038564782 -0.42715254150770570751 0.54203530596593596513 -1.3508715305614495961 0.12349180812373172778 0.048672378474476078736 0.62746958964552690396 -0.80617028602451890062;-0.93466243615431499059 -0.044448166382124169871 -0.18406453620131579818 0.27195199362697008993 0.25653029808426602854 -0.62722744880523617628 0.3334182132605678639 1.188912338649515954 0.4885874541532764237 0.42508239196393893256;-0.64586767985812743031 -0.65113370496122202624 -0.40923530340460723131 0.4500899118380243813 -0.61402302093734384414 -0.77533750112036603497 -0.69028447932464653825 0.26155672330398183068 -0.34258683908524040218 -0.91019186896148396304;-1.5038727398293001425 1.2976509073817938944 -1.0823406111208861979 -1.3236593934601601497 -0.57701902175359620628 -0.30837673219978484207 -1.1250258608619763123 0.065295552473648474368 -0.14357342795139318992 -0.88521818593019663268;0.24936104928076208154 -0.011439223777440351779 -0.62726782190387209148 -0.30756288456504010664 1.0239985813759864275 0.49402417139626597642 -0.19801254835653886444 -0.52272474361543264099 -0.033225762078100420926 -0.08937549552689216803;-0.22701293994123075692 0.75358468528902355921 -0.33260407423262766669 0.47218147732107801362 -0.83052088243761679198 0.35558373305119866936 0.70834704219084176913 0.9298633698627204458 -0.59960248133557081385 -0.36467879685940846057;-0.47585045269316872396 0.31771641725927901589 -0.33389075609619428553 -0.83080429920813336775 0.2027713981783132724 -0.38039876585474896586 -1.1195250996284569212 -0.14802385452510738451 0.86784628635316674039 0.39718204632879189342;-1.6301914539288184791 -0.83386583031922811848 -1.3068963943046243426 -2.2414924433776395318 -0.56516516763204516227 0.33906227535476102242 0.39846880298191456049 -0.19790700281394094096 -0.59643023555393570589 -0.16823324687839430469;0.84609957541596059194 0.18082374549290400334 0.019762430136498219946 -1.046692757321960654 0.17476718016411410539 0.37705308505927753737 0.17575947520447679495 0.24911831404043746629 0.8856800285051615873 1.0697556001032799688;-0.85709530228395613971 -0.60575972622098861464 -0.85745678839159544804 -1.054668368582214466 -0.68329602577308989897 0.5878551113037461251 0.42080607696304639376 0.71727044684409979602 0.35693446675628764941 -0.39379397212340427892;0.15517564196110958386 -0.42873210784920490202 -1.2475828131839965529 1.1222775415072967498 0.95420505745713801726 0.056307352545722257064 0.08590203455533129695 -0.40341245292078364848 0.52813216453478661894 0.074214368750019688026;0.84584817043791293845 -1.1643186483742273829 -0.55973851543929098451 0.38629117519994654595 1.0856144567066410289 2.9143727838442035072 0.048274788567803469941 -0.59119186788634625618 -0.92301506179910874916 -0.35175062397483031207;0.34536721619430382768 -0.59908419540030399819 0.73407058496414179238 -0.54551348198193683192 0.50425448310470655233 -0.76036314398315296703 -0.76078426391185727251 0.46429185899339214805 -0.54064602722465149309 -0.69274122205957200382;-0.19097687472660127006 1.9157234882068059356 0.027539173451430195433 -0.88518705281605813973 0.22956955820160371284 0.35987482711919321909 -0.14192197428382188895 -0.60805107403166758218 -0.74066039492307722547 0.1995620679760660432;0.071197534022244449159 -0.67192582706563086514 -0.50343529045801005406 0.75762986292391132359 -0.68729824082478840896 0.57354238072016594518 -0.71157276319199502801 0.38909476681041410551 -0.74110988045041426009 -0.49479322756791843663;0.2801688303297797944 -0.56420132458005312071 0.19393551648311721514 0.83322815756134926968 -0.1285934325873212547 0.54138007927033360289 -0.3407815292133127838 1.2254524902853702883 -0.69562555729365738166 0.054418969053209566289];

% Layer 4
b4 = 0.41387027418855015792;
LW4_3 = [0.29008340036581192756 0.14615347575008419412 -0.050607873859357360713 0.29185654928919241291 0.79778181040084272801 -0.62640616008780403146 0.1698383542304372773 -0.79783752906403415661 0.48301937136605926915 0.022477188280235486234 -0.637098135852244285 -1.1218603541192710971 -0.41712373748788444949 0.89606218991418429276 -0.53210352928467818945 -1.315898198389503948 -0.92427417513432541529 -0.4821222414041162474 -0.45118065174734256484 0.42198814704203913006];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.499999999999991;
y1_step1.xoffset = -2.00000000000004;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = tansig_apply(repmat(b3,1,Q) + LW3_2*a2);
    
    % Layer 4
    a4 = repmat(b4,1,Q) + LW4_3*a3;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a4,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(4,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
