function [Y,Xf,Af] = nnmove_21(X,~,~)
%NNMOVE_21 neural network simulation function.
%
% Auto-generated by MATLAB, 07-May-2024 19:04:13.
% 
% [Y] = nnmove_21(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 3xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-13.2925490923537;-6.70139767883548;-1.99738196042707];
x1_step1.gain = [0.0638195875959219;0.168202204644631;0.502170423671263];
x1_step1.ymin = -1;

% Layer 1
b1 = [3.8248627563257056039;3.3485718170323925946;-3.2163126729527466985;2.5315885554484087727;1.7511807420434670757;-1.359905293134035853;1.4125271566092270081;-0.36826359155520244082;0.97811323517634596314;0.74485466695724777964;0.74186054528817102494;0.70258482783945308547;2.4461132406004857387;1.291308935774814648;0.77182793751242528835;-2.4884840574953086545;-2.4855740329404754085;-2.4710424622594899802;3.4815523434056219187;-4.3935830089973038071];
IW1_1 = [-2.6292771777799068822 -1.6481688448053852802 -2.2086051564437028105;-3.0654969584765470181 -0.84571337460797169072 -2.40715655099546888;0.26746661255980075378 2.0275214574682705049 2.8509990019400706096;-2.7430692578498856449 2.8431919230480997562 -0.24720714011352862283;-3.1364418766392181404 1.4893144603866605991 1.7086814604534594775;2.8707740499084031249 1.4409788735787978364 -2.6999323064938360872;-1.2969836731838373378 2.8654822012556544486 -1.9536079566493540494;0.87129643500602027562 -2.1972818041858461768 -2.6410288942260997658;-2.2206034682466984087 -0.011376800189295627197 2.8901004092932471856;-0.85593038438693158643 -0.97923799720691417914 -3.6139277512668441794;5.7440495920301612998 1.4862252768679673487 -0.67887968969477274772;-2.6385060919102021337 -2.1405972040827210279 -1.5302997490024816685;3.3469939698154473895 -0.26621189537167755379 -0.61674666594712446166;2.0449905434647290825 -2.6463897520974510869 -0.18649826495849797237;2.2529754408060806981 -2.9624105759862562337 -0.92252749510206089045;-2.499834599644107147 3.1228492314112417105 0.17509027438530860854;-2.3601100711365057272 1.43457186694889538 3.0760504520523817007;-1.4785732394644699461 3.1949699055545899284 2.2430092905566034744;0.56340947393509566155 3.2433545895328550479 1.7158535753565713478;-1.9337764790791067693 -1.7115699177413017384 -2.0114181388154017682];

% Layer 2
b2 = [-1.732298899067720388;1.2769092603193095137;0.9814441265944574555;0.66495941697711047347;0.25378399178650190571;-0.17474643272811776762;0.64821097523636739268;-0.84219986026318660599;1.0631035206837686768;1.3788384366047439222];
LW2_1 = [0.60841184451569718661 0.35485631539781031796 -0.057350256529406694328 0.70289735292523936039 -0.4861149645776103867 -0.1056523360623160962 0.24202186870967035137 -0.18010567182471659553 0.060651257505852824992 0.33084655549789787621 -2.0246716910080895246 0.75091541082858315193 -0.34701640955706913871 0.32422435118052322922 -0.56208979339423603694 0.040402749802698492698 1.0991539613250658203 -0.54913460011428938401 0.6769722769194547185 -0.17408332047030597445;0.14597931218738421921 -0.15817647817842517277 -0.39373969666206554141 0.90041703269703088353 -0.14456572038970375016 -0.41342760235033609861 0.42974167258269574399 0.50951360732069639337 -0.1477866110591225246 0.5092862753032008083 0.53401414610646102954 -0.32272187337545493735 0.043557963856152265292 0.081565825971480807044 0.62955263310446607505 0.0045855263129886535828 -0.67903132228258922254 -0.44482559410817468226 0.061079311636842652244 0.14888554971849149444;0.036041282068085718493 0.19376642068405114383 -0.16682076797230277476 -0.25787266942077752274 -0.71597542143102987922 -0.57855396064645325804 -1.1709162305341389576 0.13910102794641049373 0.72361439662952009577 -0.35444115350086341509 0.01129503894717164697 -0.25848431911288644036 0.18259559431789829098 0.61646434455334031544 0.29406227649904953525 -0.28440064295200317979 0.51908917958182099195 -0.89628406829310980353 -0.0021346431983961609152 0.61404238804926902784;0.067817796272362729226 -1.0013924450983100467 0.13812743523244688792 0.67738390151498717451 -0.15015096538626643285 -0.059328880148489082647 0.51423504431843358731 0.021200466659257330426 -0.39553425499983957403 -0.30497002169186232523 -0.76045624885466811538 0.32666516907961529181 -0.25480948475822334798 -0.30258799638834776857 -0.40922477727805434133 0.98064993837031022572 -0.2229123302474238788 0.73012013742222325874 -0.17849691219814525778 -0.13523416048403871792;-0.059507228286370415782 -0.53081389770292164432 -0.29922886152790156844 0.091008364815474654397 -0.044149459625136722174 0.056348482712402413186 1.0208205561441345832 0.55387768091902034318 -0.39735802418860610707 -0.24187117819325604229 0.31834301318254060176 -0.76490897319633388562 -0.14040531329071223587 -0.61749680752493385505 -0.58683449366238471523 -0.43407408136854858105 -0.69308129760740733172 -0.59989292897228352341 -0.13374601616460743414 -0.4343719515528116637;-0.42294319463712587437 -0.547108431455541111 -0.26597381796536156973 -0.41095020346044980331 -0.63753532102344723231 1.2400696870954834861 0.097927408517795216936 0.050018871935848967236 -0.46460308759105267695 -0.51923020468574165864 1.0377105458684376948 0.58121210713904314371 0.098152230678142882159 -0.054740056379095555772 -0.28576186915699275382 -0.51210284918958526301 0.32049224727306951932 0.044688240708145483826 -0.59910771625843894927 -0.34842462538950591533;0.51592657621431192716 -0.040284675942437599139 0.0061448646151265173126 0.041639865465306159786 0.67563999523195983343 -0.31917717157970942887 -0.4554727995545286845 -0.19458971104952688114 0.2023714743210781597 -0.15952480037961080939 0.36359920363188857895 0.072949249873289975787 -0.17901967082410874532 0.29967174459185813573 -0.13666090254719742703 0.44752206311869446864 0.52737646555861861231 0.64352323291223367807 -0.27231674020246526835 -0.16793663399661054592;-0.15408951953809263413 -0.34164884836512637856 -0.78002959557209039509 0.25302324908389767222 0.60571318465603429804 -1.116764381583132737 0.6208781464072489209 -0.018058385774894134684 0.43731138955263904045 0.5334188068573459951 0.20648456785937932545 0.13076137480209232278 -0.84665606716500496631 0.16980073085630001395 -0.70253372132455704779 0.1498873846117572961 -0.89816091082556459568 -0.40248272274454965913 -0.35784065051902314014 0.37720398316246162018;0.31420009334421800107 -0.0090707674725532226601 0.27531757486129299073 -0.067650694814763226437 -0.42023400529192805886 -0.60037994911731984438 -0.29548883242715562325 0.24184867539171772677 0.43166996573359733835 0.67484066070940640358 1.1732707914604307842 -0.044298528566756215086 -0.67402035209007338246 0.098581528664878154133 0.73095064529752351579 -0.22574748833976232554 -0.044916125955998337238 -0.33651469372057035701 0.1916929625821004457 0.19017919410905198552;0.31996422830422971417 -0.95375106441773938037 -0.024891943388567403656 -1.2677186779291536034 0.16118218539143658319 0.79843785605758488266 -0.27179208418952072179 -0.30049023483388331845 -0.36987025741054685435 0.16151714912676543023 3.9600840332830187229 -0.13008172800968575977 0.14273932728919283552 0.33495941316016708544 0.42609049075381011384 -0.82685270662659671181 -0.049158716829900132861 0.2734844619333992588 0.12762705624453440922 0.60969514590832707412];

% Layer 3
b3 = [2.2384248388270551189;-2.014007479637026421;1.6167699763035496829;-1.7749459013731503365;1.1804776494347029026;1.3794407832060069374;0.87768143085337912979;0.39482655060743337971;-0.00720079401058308817;-0.1587224740632705855;-0.21309540342381744216;-0.52671101405258569095;-0.29375090188347580122;0.52911285375013750176;0.85242945148636450892;1.0313917448264395826;1.0939051494155758171;1.9117483567432742575;1.9515460366566206307;2.0700716304567463588];
LW3_2 = [-0.92826723778139441645 -0.29179214669178193953 -0.56245407983097039928 0.16301426868520144109 0.49008975657822972938 0.66518798786968635905 0.40777774181838866152 -0.64985370790455654344 0.15833412944394339994 -0.016119764438386925687;0.39679356147888505957 0.066115003816300310646 -0.48968411129882660759 -0.66952080562416715903 -1.0114439145303848466 -0.031788421365359628701 0.72127898680575985857 0.22145148458001387426 0.12604436030778917721 -1.0183060367679666047;-0.70066699976722457421 -0.15823896563533548787 -0.14292710855026791172 -0.44291207332972437616 0.81224640828906313761 -0.57298723393546047156 -0.76610051323622219144 -0.32931422247354391608 0.87645297209194517052 -0.21767575117022078257;0.66132990721883644358 -0.29749750539456210063 -0.45591195260865774452 0.49993535887470474943 0.27024639617188145335 -0.28543371536694583934 -0.7328026151664531751 -0.29713899833055135158 -1.2340286535392941403 -2.2028745379310468167;-0.91132504419862758738 0.27972831774521850212 -0.037567182373751284441 -0.49382634521055351895 -0.49117444509446916978 -0.69418471116237123741 -0.76764318923174246212 -0.44907137380795447701 0.1900565073812453265 -0.86641723318931418429;0.045642388784922161005 -0.16180718522375800439 -0.21266091939320325155 -1.3873475064668734369 -0.76899303566962184942 1.0640310359775064786 0.76977509606211458326 -0.0024498508936972133998 -0.22480957226396305892 0.76276662692133878618;-0.16369783181378072534 1.0461275566693331029 0.29222562142819413777 0.7057523423773301996 -0.98578425397081526071 0.059636111009511584558 -0.72186846989416131315 -0.33063244969517158189 -0.69915351792933699837 0.072585205122601595407;-1.1027867488787657102 -0.47514706163886727408 0.99961591701087260109 -0.14825204960790808184 1.0662522850760767223 -0.56286261338747312077 -0.24926312696158858806 -0.04039324659601273293 0.56609208687123235837 -0.58712785909059683753;-0.68294996123616114048 0.4167980707646815608 -1.1509047548138275907 -0.46531721216223520532 0.24430890132941804338 -1.0227708634180459057 -0.76676273965627128604 -0.0043995206893114036095 0.2606612251350166054 0.74778984568602169247;0.35453787842441003564 0.23796148159943486533 -1.0610352599350729719 -0.40388128398056305501 -0.44128241959819419771 -0.23918504339135354675 -1.0110256214102490979 0.20750968988079362965 0.74530696076610825074 -1.1968487706939665571;0.52500560843812527079 -1.5592073053733963572 0.90780258888448961407 -0.16935539421938572424 0.619850128686780244 0.26833376076015291734 0.53328446741347612647 -0.17958141121947646113 -0.42765791187385582273 -0.50632887876736387689;-1.0746998433221344182 -0.63039136886948743399 0.12468242989354630379 0.266137694041169659 0.18131460690090003829 -0.28764847121482778336 -0.5191160184037978409 1.1555818913170781137 -0.23824566332236940536 0.27220151085784000111;-0.38428029928823459471 -0.13104593840616635125 -0.6833390660046609888 -0.22021468334533389477 0.089415465438672708798 0.78539785893483993195 -1.1219589642223142256 -0.48107077555478205966 -0.5219841879094621051 0.14874403731957222541;0.46076040032345183528 -1.0016170097622389967 0.94765615801326330558 -0.18937420895073880933 0.71272189017454889992 -0.39968743902474040963 0.4633769876830440837 0.2510421819407425148 -0.0391904109232067005 1.0748972029017318519;0.56571826454913864968 -1.0279326703257043452 -0.53129569809862720042 0.46064322031428617255 0.75769374622256102647 0.36306865034850938079 0.050285504254300367188 0.92165613056815609561 -0.059042108479558479128 0.58548640466114043601;-0.081186649466805621556 0.55981498640458282612 -0.44941800215200733426 -0.03957900605564226848 0.83862995025878328548 0.80464715394962749162 -0.59232457767998991649 -0.78246821970216107189 -0.88243903557700387186 -0.12992980853687702281;0.86466460124262145559 0.42833890954803977014 -0.66890579311844011734 0.14350303995400220947 -0.093759755814858070089 0.50911371365348123685 0.74435778797416718433 0.99504628885873547262 -0.83149715368445020758 0.28429492943802120442;0.39768337521242325128 0.33959109941797771537 0.061815557888665759179 -0.5558168733621721147 1.253386610999948525 0.31032970962086914302 -0.15130600414208425497 0.45759745122873424217 0.97470926319188366804 0.90741964046850653869;1.4861528153783247763 0.27503999892611430411 -0.76972027746710647289 0.17641431778357008486 1.7630086543319720693 -0.12968302142327842175 -0.060235802586855943797 -0.057958933087565313313 0.2046753704143055852 -2.4682825159673056348;0.12577722544594083232 -0.029783312372175109461 0.33516719201927835936 0.88832109307735207526 -0.77496593594474716404 0.69034026057137698462 -0.25299709680391929689 -1.225637006962532416 0.14453989030803496285 0.083261773157028706738];

% Layer 4
b4 = -0.36360915056726395012;
LW4_3 = [0.12979499455570511768 -0.34576456976514441388 0.15486165900914880544 -1.3240467757461484855 0.0039117694571098220527 0.45183851293615456823 0.10722267902792571859 -0.022342856405172167866 0.0056411854045632509047 -0.19518932215042592015 0.59003882892307024655 -0.26936410896279999738 -0.10331946984648955612 -0.91052252598023708519 0.75831136763008200052 0.21456002616991826093 0.4917468344468894359 0.10198855492963536384 -1.2192427700940713375 -0.23490523931613013775];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.499999999999945;
y1_step1.xoffset = -2.00000000000019;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = tansig_apply(repmat(b3,1,Q) + LW3_2*a2);
    
    % Layer 4
    a4 = repmat(b4,1,Q) + LW4_3*a3;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a4,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(4,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
